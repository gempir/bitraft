(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{39:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var c=n(17),r=n.n(c),a=n(9),s=n(10),o=n(12),i=n(11),l=n(0),u=n.n(l),h=n(16),j=n(25),p=n(14),d=n(7);function f(e,t){switch(t.type){case"SET_CHANNELS":return Object(d.a)(Object(d.a)({},e),{},{channels:t.channels});default:return Object(d.a)({},e)}}function b(){var e=function(){try{var e=localStorage.getItem("state");return null===e?{}:JSON.parse(e)}catch(t){return{}}}();return Object(d.a)({loading:!1,channels:{},apiBaseUrl:"https://spamchamp-api.gempir.com"},e)}var O=function e(t,n){Object(a.a)(this,e),function e(){var c=new WebSocket("".concat(t.replace("https://","wss://").replace("http://","ws://"),"/api/ws"));c.onmessage=function(e){n(JSON.parse(e.data))},c.onclose=function(t){console.log("Socket is closed. Reconnect will be attempted in 1 second.",t.reason),setTimeout(e,1e3)},c.onerror=function(e){console.error("Socket encountered error: ",e,"Closing socket"),c.close()}}()},v=n(28);function m(e){try{var t=JSON.stringify(e);localStorage.setItem("state",t)}catch(n){}}function w(e){return function(t,n){var c,r=[],a=n(),s=Object(v.a)(e);try{for(s.s();!(c=s.n()).done;){var o=c.value;a.channels.hasOwnProperty(o)||r.push(o)}}catch(i){s.e(i)}finally{s.f()}if(0!==r.length)return new Promise((function(e,c){fetch("".concat(n().apiBaseUrl,"/api/channel?channelids=").concat(r.join(","))).then((function(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t})).then((function(e){return e.json()})).then((function(c){var r;t((r=c,function(e,t){e({type:"SET_CHANNELS",channels:Object(d.a)(Object(d.a)({},t().channels),r)})})).then((function(){return m(n())})),e()})).catch((function(e){c(e)}))}))}}var x=n(27),y=n(3),g=n(2),C=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return Object(g.jsx)("img",Object(d.a)(Object(d.a)({},this.props),{},{width:"30",height:"30",alt:"profile"}))}}]),n}(u.a.Component);C.defaultProps={src:"https://static-cdn.jtvnw.net/user-default-pictures-uv/cdd517fe-def4-11e9-948e-784f43822e80-profile_image-70x70.png"};var S=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this;return Object(g.jsxs)("div",{className:"Record",children:[Object(g.jsx)("h2",{children:this.props.record.title}),Object(g.jsx)("ol",{children:this.props.record.scores.map((function(t){var n,c,r;return Object(g.jsxs)("li",{children:[Object(g.jsx)(C,{src:null===(n=e.props.channels[t.id])||void 0===n?void 0:n.profile_image_url}),Object(g.jsx)("span",{children:null!==(c=null===(r=e.props.channels[t.id])||void 0===r?void 0:r.display_name)&&void 0!==c?c:""}),Object(g.jsx)("span",{className:"value",children:t.score})]},t.id)}))})]})}}]),n}(u.a.Component),k=Object(p.b)((function(e){return{channels:e.channels}}))(S),N=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(a.a)(this,n);for(var c=arguments.length,r=new Array(c),s=0;s<c;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={joinedChannels:null,activeChannels:null,records:[]},e}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=this;new O(this.props.apiBaseUrl,(function(t){e.setState({joinedChannels:t.joinedChannels,activeChannels:t.activeChannels,records:t.records}),e.props.dispatch(w(new Set(t.records.map((function(e){return e.scores})).flat().map((function(e){return e.id})))))}))}},{key:"render",value:function(){return Object(g.jsx)(x.a,{children:Object(g.jsxs)("div",{className:"Base",children:[Object(g.jsxs)("span",{className:"Meta",children:[this.state.joinedChannels," joined channels | ",this.state.activeChannels," active channels"]}),Object(g.jsx)(y.c,{children:Object(g.jsx)(y.a,{path:"/",children:this.state.records.map((function(e){return Object(g.jsx)(k,{record:e},e.title)}))})})]})})}}]),n}(u.a.Component),B=Object(p.b)((function(e){return{apiBaseUrl:e.apiBaseUrl}}))(N),E=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var c;return Object(a.a)(this,n),(c=t.call(this,e)).store=void 0,c.store=Object(h.c)(f,b(),Object(h.a)(j.a)),c.store.subscribe((function(){return m(c.store.getState())})),c}return Object(s.a)(n,[{key:"render",value:function(){return Object(g.jsx)(p.a,{store:this.store,children:Object(g.jsx)(B,{})})}}]),n}(l.Component);n(39);r.a.render(Object(g.jsx)(E,{}),document.getElementById("root"))}},[[40,1,2]]]);
//# sourceMappingURL=main.3efcd708.chunk.js.map